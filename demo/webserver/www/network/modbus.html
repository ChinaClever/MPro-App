<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>PDU</title>
<link rel="stylesheet" href="../js/bootstrap/css/bootstrap.min.css" />	
<link rel="stylesheet" href="../css/font-awesome.min.css">
<link rel="stylesheet" href="../css/style.css" />
<script type="text/javascript" src="../js/jquery-1.8.3.min.js"></script>

<style type="text/css">
.panel-default{
            border: none;
            border-radius: 0px;
            margin-bottom: 0px;
            box-shadow: none;
            -webkit-box-shadow: none;
}

.panel-default > .panel-heading{
	color: #222;
	font-size:13px;
	background-color: #fff;
	border-color: #e6e6e6;
	padding: 10px 12px;
}

body{ 
	
	background: #fafafa;
}

tr{
	height:28px;
}
</style>
<script>
var flag;
	$(document).ready(function () {
		$.ajax({
				dataType:"text",
				url:"/npmslavelist",
				cache:false,
				success:function(sta)
				{
					var gv = new Array();
					gv=sta.split("?");
					flag = parseInt(gv[0]);
					LangFun(flag);
				}
			});
	
		var select = document.getElementById("addr");
		for(var i=1;i<=255;i++){
			var opt = document.createElement("option");
			opt.value=i;
			opt.innerHTML=i;
			select.appendChild(opt);
		}
		
		$.ajax({
				dataType:"text",
				url:"/getmodbus",
				async:true,
				cache:false,
				success:function(sta)
				{
					var gv = new Array();
					gv=sta.split("?");
					
					document.getElementById("addr").value=gv[0];
					document.getElementById("baud").value = gv[1];
					document.getElementById("databits").value = gv[2];
					document.getElementById("parity").value = gv[3];
					document.getElementById("stopbits").value = gv[4];
					
					document.getElementById("tcpport").value = gv[5];
				}
			});

		});
			
	function savemodbus()
	{
		var addr = document.getElementById("addr").value;
		var baud = document.getElementById("baud").value;
		var databits = document.getElementById("databits").value;
		var parity = document.getElementById("parity").value;
		var stopbits = document.getElementById("stopbits").value;
		
		var tcpport = document.getElementById("tcpport").value;
		$.ajax({
				dataType:"text",
				url:"/setmodbus?id1="+addr+"&id2="+baud+"&id3="+databits+"&id4="+parity+"&id5="+stopbits+"&id6="+tcpport+"&",
				async:true,
				cache:false,
				success:function(sta)
				{
					
					if(flag==0)
					{
						if(sta=="flase")
						{
							alert("No permission!");
						}
						else if(sta=="err1")
						{
							alert("Incorrect settings!");
						}
						else
						{
							alert("Settings succeed, please restart the device!");
						}
					}
					else
					{
						if(sta=="flase")
						{
							alert("不允许!");
						}
						else if(sta=="err1")
						{
							alert("设置错误!");
						}
						else
						{
							alert("设置成功，请重启设备!");
						}
					}
				}
			});
	}
	
	function LangFun(flag)
	{
		var lang_1  = ["Modbus service", "Modbus服务", "Service Modbus", "служба Modbus", "Servicios modbus", "خدمة Modbus"];
		var lang_2  = ["Modbus RTU setting", "Modbus RTU设置", "Terminal Modbus RTU", "Настройки Modbus RTU", "Configuración de modbus rtu", "إعدادات RTU Modbus"];
		var lang_3  = ["Modbus address:", "Modbus地址:", "Adresse Modbus", "адрес модуса", "Dirección modbus", "عنوان Modbus"];
		var lang_4  = ["Baud rate", "波特率:", "Taux d 'onde", "процент Поттера", "Pot", "معدل باود"];
		var lang_5  = ["Data bits", "数据位:", "Bit de données", "бит данных", "Bits de datos", "بت البيانات"];
		var lang_6  = ["Parity", "奇偶性:", "Parité", "нечётность", "Rareza.", "مساواة"];
		var lang_7  = ["None", "无", "Néant", "None", "Ninguna", "لا"];
		var lang_8  = ["Even number", "偶数", "Pair", "Pair", "Pares", "عدد زوجي"];
		var lang_9  = ["Odd number", "奇数", "Impair", "нечётное число", "Singular", "عدد فردي"];
		var lang_10  = ["Stop bit", "停止位:", "Position d 'arrêt", "бит остановки", "End sub", "توقف قليلا"];
		var lang_11  = ["Save", "保存", "Enregistrer", "Сохранить", "Guardar", "تخزين"];
		
		var lang_12 = ["Modbus TCP setting", "Modbus TCP设置", "Terminal Modbus TCP", "Настройка Modbus TCP", "Configuración de modbus TCP", "إعدادات TCP Modbus"];
		var lang_13 = ["Modbus port:", "Modbus端口号:", "Adresse Modbus", "адрес модуса", "Dirección modbus", "عنوان Modbus"];
		var lang_14  = ["Save", "保存", "Enregistrer", "Сохранить", "Guardar", "تخزين"];

		document.getElementById("lang_1") .innerHTML = lang_1[flag];
		document.getElementById("lang_2") .innerHTML = lang_2[flag];
		document.getElementById("lang_3") .innerHTML = lang_3[flag];
		document.getElementById("lang_4") .innerHTML = lang_4[flag];
		document.getElementById("lang_5") .innerHTML = lang_5[flag];
		document.getElementById("lang_6") .innerHTML = lang_6[flag];
		document.getElementById("lang_7") .innerHTML = lang_7[flag];
		document.getElementById("lang_8") .innerHTML = lang_8[flag];
		document.getElementById("lang_9") .innerHTML = lang_9[flag];
		document.getElementById("lang_10").innerHTML = lang_10[flag];
		document.getElementById("lang_11").value	 = lang_11[flag];
		
		document.getElementById("lang_12").innerHTML = lang_12[flag];
		document.getElementById("lang_13").innerHTML = lang_13[flag];
		document.getElementById("lang_14").value	 = lang_11[flag];
	}
</script>
</head>
<body>
<div style="padding: 0px; margin-bottom: 0.8%; overflow: hidden; ">
	<div class="box" style="float: left; width: 100%; margin-bottom: 0.8%; height:96%; background:#e7e7e7;">
		<div class="panel panel-default">
			<div class="panel-heading" ><i class="fa fa-th-list fa-lg" style="padding-right: 5px;" ></i ><span id="lang_1"></span></div>			
		</div>
		
		<div style="border:1px solid;border-color: #ffffff; margin:10px; height:225px; background:#ffffff; ">		
			<table width="100%" border="0" style="font-size:12px;">
			<tr>
				<td width="10px"></td>
				<td width="120" id="lang_2"></td>
				<td></td>
			</tr>		
			<tr>
				<td width="10px"></td>
				<td width="120" nowrap id="lang_3"></td>
				<td>
					<select id="addr" style="width:200px">
					</select>
				</td>
			</tr>
			<tr>
				<td width="10px"></td>
				<td width="120" nowrap id="lang_4"></td>
				<td>
					<select id="baud" style="width:200px">
						<option value="9600">9600</option>
						<option value="19200">19200</option>
						<option value="38400">38400</option>
						<option value="57600">57600</option>
						<option value="115200">115200</option>
					</select>
				</td>
			</tr>
			<tr>
				<td width="10px"></td>
				<td width="120" nowrap id="lang_5"></td>
				<td >
					<select id="databits" style="width:200px">
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8">8</option>
					</select>
				</td>
			</tr>
			<tr>
				<td width="10px"></td>
				<td width="120" nowrap id="lang_6"></td>
				<td >
					<select id="parity" style="width:200px">
						<option value="None" id="lang_7"></option>
						<option value="Even" id="lang_8"></option>
						<option value="Odd" id="lang_9"></option>
					</select>
				</td>
			 </tr>
			 <tr >
				<td width="10px"></td>
				<td width="120" nowrap id="lang_10"></td>
				<td >
					<select id="stopbits" style="width:200px">
						<option value="1">1</option>
						<option value="2">2</option>
					</select></td>
			</tr>
			<tr>
				<td width="10px"></td>
				<td><input style="margin-top:10px; height:21px; width:50px;"  type="button"  onClick="savemodbus();" id="lang_11"></input></td>
				<td></td>
			</tr>
			</table>
		</div>
			
		<div style="border:1px solid;border-color: #ffffff; margin:10px; height:230px; background:#ffffff;">
			<table width="100%" border="0" style="font-size:12px; margin-top:10px;">
			<tr>
				<td width="10px"></td>
				<td width="120" id="lang_12"></td>
				<td></td>
			</tr>				
			<tr>
				<td width="10px"></td>
				<td width="120" nowrap id="lang_13"></td>
				<td>
					<input id="tcpport" style="width:200px"></input>
				</td>
			</tr>
			<tr>
				<td width="10px"></td>
				<td><input style="margin-top:10px; height:21px; width:50px;"  type="button"  onClick="savemodbus();" id="lang_14"></input></td>
				<td></td>
			</tr>
			</table>
		</div>	
	</div>
</div>
</body>
</html>
