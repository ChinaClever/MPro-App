<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>home</title>
		<link rel="stylesheet" href="include/css/public.min.css">
		<link rel="stylesheet" href="include/css/index.min.css">
		<link rel="stylesheet" href="include/css/iconfont.min.css">
		<link rel="stylesheet" href="include/css/font-awesome.min.css">
		<link rel="stylesheet" href="doc-lib/solarized-light.css">
		<link rel="stylesheet" href="doc-lib/doc.css">

		<script src="include/js/jquery-1.11.3.min.js"></script>
		<script src="include/js/rpc-over-websocket.js"></script>
		<script src="include/js/public.min.js"></script>
		<script src="include/js/fn_public.js"></script>
		<script src="doc-lib/highlight.pack.js"></script>
		<script src="doc-lib/doc.js"></script>
		<script src="include/js/chart.min.js"></script>
		<style>
			.box{
				border: 1px solid #C4C2C3;
				background-color: #fff;
			}
			tr{
				height: 30px;
			}
		</style>
	</head>
<body>
	<div style="padding: 0px; margin-bottom: 0.8%; overflow: hidden; ">
		<div class="box" style="width: 100%; margin-bottom: 0.8%;  background:#e7e7e7;">
			<div class="panel panel-default">
				<div class="panel-heading"><i class="fa fa-sitemap fa-lg" style="padding-right: 5px;"></i><span id="lang_1"></span><ul style="float:right; font-family:courier;" ><span id="lang_2"></span><select id="ms" style="width:200px;" onChange="change();"></select></ul></div>
			</div>
			<div class ="phase_div1">
				<div class ="phase_div2" id="lang_3"></div>
				<div class ="phase_div">
					<table class ="phase_table total"></table>
				</div>
				<div class ="phase" id="L1">
					<table class ="phase_table p1"></table>
				</div>
				<div class ="phase " id="L2">
					<table class ="phase_table p2"></table>
				</table>
				</div>
				<div class ="phase" id="L3">
					<table class ="phase_table p3"></table>
				</div>
			</div>
			<div id="ht" class = "loop_div">	
				<table class = "loop_table "></table>
			</div>
			<table style="width:100%;height:203px; ">
				<tr>
					<td style=" width: 64%;">
						<div style=" width: 99%; margin-bottom: 0.8%; border:1px solid;border-color: #ffffff; margin-left:10px; height:203px; background:#ffffff; text-align:center;">
							<div style="text-align:left; padding-left:20px; padding-top:8px; height:40px; border-bottom:#e1dfdf 2px solid; font-size:12px;" id="lang_16"></div>
							<table class = "sensor_tab" style="height:32px; width:100%; font-size:12px;"></table>
						</div>
					</td>
					<td style="width: 32%;">
						<div style="width: 97%; margin-bottom: 0.8%; border:1px solid;border-color: #ffffff; margin-top:-5px; margin-left:10px; height:203px;  background:#ffffff; ">
						<div style="text-align:left; padding-left:20px; padding-top:8px; height:40px; border-bottom:#e1dfdf 2px solid; font-size:12px;" id="lang_29"></div>
						<table class = "sys_table" style="width: 97% ;font-size:12px;"></table>
						</div>
					</td>
				</tr>
			</table>
			<div align="center" style="border:0px solid;border-color: #aaaaff; margin:0px 10px 10px 10px; height:550px; background:#ffffff;">
				<div style="text-align:left; padding-left:20px; padding-top:8px; height:40px; border-bottom:#e1dfdf 2px solid;" id="lang_35"></div>
					<br>
					<div  id="container" style="width:90%; height:500px;">
						<canvas id="chart" style="display: block; width: 90%; height: 410px;"></canvas>
					</div>
					<script type="text/javascript">
						var sample_num = 50;
						var data_total = new Array(3);
						var data_inlet1 = new Array(3);
						var data_inlet2 = new Array(3);
						var data_inlet3 = new Array(3);
						var data_view = new Array(50);
						let date  = new Date();
						let Hou= 0, Minu = 0,Seco = 0;
						Seco = date.getSeconds();
						Minu = date.getMinutes();
						Hou = date.getHours();
						var dataLabels = new Array();
						for(var i = 0;i<3;i++){
							data_total[i] = new Array();
							data_inlet1[i] = new Array();
							data_inlet2[i] = new Array();
							data_inlet3[i] = new Array();
							for(var j = 0;j < sample_num;j++){
								data_total[i][j] = 0;
								data_inlet1[i][j] = 0;
								data_inlet2[i][j] = 0;
								data_inlet3[i][j] = 0;
							}
							for(var k = sample_num;k>0;k--){

								data_view[k] =0;
								Seco -=  3;
								if(Seco < 0){
									Seco = 60 + Seco -3;
									Minu -= 1;
									if(Minu < 0){
										Minu =  59;
										Hou -= 1;
									}
									if(Hou < 0){
										Hou = 23;
									}
								}
								dataLabels[k-1] = (Hou<10?'0'+Hou:Hou) +':'+(Minu<10?'0'+Minu:Minu) + ':' + (Seco<10?'0'+Seco:Seco);
							}
						}
						var config = {
							type: 'line',
							data: {
								labels: dataLabels,
								datasets: [
									{
										label: 'total_pow',
										data: data_total[1],
										backgroundColor: 'rgb(255, 99, 132)',
										borderColor: 'rgb(255, 99, 132)',
										fill: false,
									},
									{
										label: 'inletA',
										data: data_inlet1[1],
										backgroundColor: 'rgb(75, 192, 192)',
										borderColor: 'rgb(75, 192, 192)',
										fill: false, 
									},
									{
										label: 'inletB',
										data: data_inlet2[1],
										backgroundColor: 'rgb(128, 128, 128)',
										borderColor: 'rgb(128, 128, 128)',
										fill: false,
									},
									{
										label: 'inletC',
										data: data_inlet3[1],
										backgroundColor: 'rgb(70, 130, 180)',
										borderColor: 'rgb(70, 130, 180)',
										fill: false,
									}
								]
							},
							options: {
								responsive: true,
								title: {
									display: true,
									text: '功率信息实时统计'
								},
								scales: {
								xAxes: [{
									ticks: {
										min: 50,
									}
								}]
    }
							}
						};
				
						var ctx = document.getElementById('chart').getContext('2d');
						var chart = new Chart(ctx, config);
						function chart_data_read(){
				
						}
						setInterval(function() {
							if (config.data.datasets.length > 0) {
								date  = new Date();
								Seco = date.getSeconds();
								Minu = date.getMinutes();
								Hou = date.getHours();
								label_ = (Hou<10?'0'+Hou:Hou) +':'+(Minu<10?'0'+Minu:Minu) + ':' + (Seco<10?'0'+Seco:Seco);

								dataLabels.push(label_);
								data_total[1].push(getRandomNum(500, 700));
								data_inlet1[1].push(getRandomNum(200, 300));
								data_inlet2[1].push(getRandomNum(100, 150));
								data_inlet3[1].push(getRandomNum(150, 200));
				
								dataLabels.shift();
								data_total[1].shift();
								data_inlet1[1].shift();
								data_inlet2[1].shift();
								data_inlet3[1].shift();

								chart.update();
							}
						}, 3000);
				
						function getRandomNum(min, max) {
							var range = max - min;
							var rand = Math.random();
							return(min + Math.round(rand * range));
						}
				
					</script>
				</div>
			</div>
		</div>
	</div>
    <script>
		var phase_info = new Array();
		var total_info = new Array();
		var system_info = new Array();
		var loop_info = new Array();
		var sensor_info = new Array();
		var phase_num = parseInt(sessionStorage.getItem("PhaseNum" + addr));
		var loop_num = parseInt(sessionStorage.getItem("LoopNum" + addr));
		var len  = data_name.length -1;
		var total_title = new Array("kW","kVA","kWh","Hz","mA");
		var lang  = new Array(36);
		var dev_name = new Array();
		var slave_num = parseInt(sessionStorage.getItem("SlaveNum" + addr));
    	var head = new Array("Tmp","Tmp","Hum","Hum","Door1","Door2","Water","Smoke");
		var stat_ = new Array("断开","闭合");
		function LangFun()
		{
			for(var i = 0;i<lang.length;i++){
				lang[i] = new Array();
			}
			lang[1]   = ["Dashboard", "首页", "Tableau", "Первая страница", "Página", "منزل"];
			lang[2]   = ["PDU Selection: ", "设备选择:", "Dispositif Choix:", "Выбор устройства:", "Selección del dispositivo:", "اختيار المعدات:"];
			lang[3]   = ["Input ", "输入", "Input", "вход", "Entrada", "دخول"];
			lang[4]   = ["Electric energy: ", "电能消耗:", "Énergie électrique: ", "расход электроэнергии: ", "Consumo de energía eléctrica: ", "استهلاك الطاقة"];
			lang[5]   = ["Frequency:", "频率:", "Fréquence:", "частота:", "Frecuencia:", "تردد:"];
			lang[6]   = ["Leakage current:", "漏电电流:", "Courant de fuite:", , "ток утечки:", "corriente de fuga:", "التسرب الحالي:"];
			lang[7]   = ["Output", "输出", "Output", "выход", "Salida", "تصدير"];
			lang[8]   = ["Circuit", "回路", "Circuit", "цепь", "Vuelta", "فرع الطريق"];
			lang[9]   = ["Status", "状态", "état", "состояние", "Estado", "دولة"];
			lang[10]  = ["Outlet", "输出位", "Output bit", "выходной бит", "Salida de salida", "الانتاج قليلا"];
			lang[11]  = ["Load current", "当前电流", "Courant", "текущий ток", "Corriente actual", "التيار الحالي"];
			lang[12]  = ["Overload current", "过载电流", "Surcharge Courant", "максимальный ток", "Corriente de sobrecarga", "الزائد الحالي"];
			lang[13]  = ["Input voltage", "当前电压", "Tension", "текущее напряжение", "Tensión actual", "الجهد"];
			lang[14]  = ["Apparent power", "视在功率", "Puissance optique", "кажущаяся мощность", "Potencia visual", "القوة الظاهرة"];
			lang[15]  = ["Energy consumption", "电能消耗", "Énergie électrique", "расход электроэнергии", "Consumo de energía eléctrica", "استهلاك الطاقة"];
			lang[16]  = ["Sensor", "传感器", "Capteur", "датчик", "Sensor", "الاستشعار"];
			lang[17]  = ["Sensor name", "传感器名称", "Capteur Nom", "наименование датчика", "Nombre del sensor", "اسم المستشعر"];
			lang[18]  = ["Sensor status", "传感器状态", "Capteur état", "состояние датчика", "Estado del sensor", "حالة الاستشعار"];
			lang[19]  = ["Sensor name", "传感器名称", "Capteur Nom", "наименование датчика", "Nombre del sensor", "اسم المستشعر"];
			lang[20]  = ["Sensor status", "传感器状态", "Capteur état", "состояние датчика", "Estado del sensor", "حالة الاستشعار"];
			lang[21]  = ["Temperature 1", "温度1", "Temperature 1", "температура1", "Temperatura 1", "درجة الحرارة 1"];
			lang[22]  = ["Humidity 1", "湿度1", "Humidité 1", "влажность1", "Temperatura 1", "الرطوبة 1"];
			lang[23]  = ["Temperature 2", "温度2", "Temperature 2", "температура2", "Temperatura 2", "درجة الحرارة 2"];
			lang[24]  = ["Humidity 2", "湿度2", "Humidité 2", "влажность2", "Temperatura 2", "الرطوبة 2"];
			lang[25]  = ["Door1", "门禁1", "Door1", "вход1", "Puerta 1", "التحكم في الوصول 1"];
			lang[26]  = ["Door2", "门禁2", "Door2", "вход2", "Puertas 2", "التحكم في الوصول 2"];
			lang[27]  = ["Water", "水浸", "Eau", "погружение", "Inmersión", "الفيضانات"];
			lang[28]  = ["Smoke", "烟雾", "Fumée", "дым", "Humo", "دخان"];
			lang[29]  = ["Information", "信息", "Information", "сведения", "Información", "معلومات"];
			lang[30]  = ["Working status:", "工作状态：", "Travail état:", "режим работы:", "Estado de trabajo:", "حالة العمل:"];
			lang[31]  = ["PDU location:", "PDU位置：", "PDU Position:", "PDU должность:", "Posición PDU:", "Posición PDU:"];
			lang[32]  = ["PDU uptime:", "运行时长：", "Temps:", "длительность эксплуатации:", "Duración del funcionamiento:", "وقت التشغيل:"];
			lang[33]  = ["PDU series:", "产品系列：", "PDU Série:", "серия продуктов:", "Serie de productos:", "سلسلة المنتج:"];
			lang[34]  = ["PDU version:", "软件版本：", "PDU Version:", "версия программного обеспечения:", "Versión de software:", "إصدار البرنامج:"];
			lang[35]  = ["Real-time dynamic power and current trend graph", "实时动态功率和电流趋势图", "Temps réel diagramme dynamique", "диаграмма динамической мощности и тенденций течения в реальном масштабе времени", "Dynamic Power and Electricity Trends in Time time", "في الوقت الحقيقي قوة ديناميكية والرسم البياني الحالي الاتجاه"];
			for(var i = 1;i<36;i++){
				document.getElementById("lang_" + i).innerHTML  = lang[i][1];
			}
		}
		read_data();
		function read_data(){
			for(var i = 0;i<3; i++){
				var j = 0;
				if(i == 0){
					j = 4;
				}else if(i==2){
					j = 7;
				}else{
					j = 5;
				}
				total_info[i] = parseInt(sessionStorage.getItem(type_name[0]+ data_type[j] + data_name[1] + addr));
			}
			total[3] = 50;total[4] = 50;
			for(var i = 1 ;i < phase_num + 1;i++){
				phase_info[i] =  new Array();
				for(var k = 0; k < 3; k++){
					for(var j = 0;j <len;j++){
						phase_info[i][(len * k) + j] = parseInt(sessionStorage.getItem(type_name[phase]+data_type[(k+2)]+data_name[j + 1]+addr+'_'+i));
					}
				}
			}
			for(var i = 1 ;i < loop_num + 1;i++){
				loop_info[i] =  new Array();
				for(var k = 0; k < 3; k++){
					for(var j = 0;j <len;j++){
						loop_info[i][(len * k) + j] = parseInt(sessionStorage.getItem(type_name[loop]+data_type[(k+2)]+data_name[j + 1]+addr+'_'+i));
					}
				}
			}
			for(var i = 0; i<head.length;i++){
    			sensor_info[i] = new Array();
				if( i > 3){
					type_num = 7;
					sensor_info[i] = sessionStorage.getItem(type_name[type_num] +head[i] + "Val" + addr+"_1");
				}
				else{
					type_num = 6;
					sensor_info[i] = sessionStorage.getItem(type_name[type_num] +head[i]+ "Val" +addr+"_"+(parseInt(i%2)+1));
				}
			}
			for(var i = 0;i<slave_num;i++){
				dev_name[i] = sessionStorage.getItem("DevName" + i);
			}
		}

		$('.total').html(buildTablePhase(0));
		$('.p1').html(buildTablePhase(1));
		$('.p2').html(buildTablePhase(2));
		$('.p3').html(buildTablePhase(3));
		$('.loop_table').html(buildTableLoop(loop_num));
		$('.sensor_tab').html(buildTableSensor());
		$('.sys_table').html(buildTableSystem());
		LangFun();
		showdata();
		function showdata(){
			for(var i = 0;i<5;i++){
				if(i<2){
					document.getElementById('dat'+(i + 1)).innerHTML =  parseFloat(total_info[i]/100).toFixed(2);
				}else if(i == 2){
					document.getElementById('dat'+(i + 1)).innerHTML =  parseFloat(total_info[i]/10).toFixed(1);
				}else{
					document.getElementById('dat'+(i + 1)).innerHTML =  total_info[i];
				}
				
			}
			for(var i = 0;i < 3;i++){
				var j = 0;
				if(i == 0){
					j == 3;
				}else if(i == 1){
					j ==2;
				}else{
					j==6;
				}
				document.getElementById('dat'+(3 * i + 6)).innerHTML = parseFloat(phase_info[i + 1][j]/100).toFixed(2);
				document.getElementById('dat'+(3 * i + 7)).innerHTML = parseFloat(phase_info[i + 1][j]/10).toFixed(1);
				document.getElementById('dat'+(3 * i + 8)).innerHTML = parseFloat(phase_info[i + 1][j]/100).toFixed(2);
			}
			for(var i = 0;i<loop_num;i++){
				for(j = 0;j<8;j++){
					if(j>2 && j!= 5 && j != 7){
						document.getElementById('dat'+(16+ i * 8 + j)).innerHTML = parseFloat(loop_info[i + 1][j]/100).toFixed(2);
					}else if(j>2 && j== 5 && j == 7){
						document.getElementById('dat'+(16+ i * 8 + j)).innerHTML = parseFloat(loop_info[i + 1][j]/10).toFixed(1);
					}else{
						if(j == 0){
							document.getElementById('dat'+(16+ i * 8 + j)).innerHTML = "C" + (i +1);
						}else if( j ==1){
							document.getElementById('dat'+(16+ i * 8 + j)).innerHTML = stat_[loop_info[i + 1][j]];
						}
					}
						
				}
			}
		}
		function modeset(modesel){
			var ms = document.getElementById("sel");
			var iptname = document.getElementsByTagName("input");
			for(var i = 0; i<iptname.length;i++)
			{
				iptname[i].disabled = true;
			}
		}
		function flash_html(par)
		{
			read_phase_data(addr);
			setTimeout(function(){
				par.parentNode.parentNode.parentNode.remove();
				read_data();
				if(par.name == "pow"){
					$('.pow_table').html(buildTablePow(phase_num));
				}else if(par.name == "cur"){
					$('.cur_table').html(buildTableCur(phase_num));
				}else if(par.name == "vol"){
					$('.vol_table').html(buildTableVol(phase_num));
				}
				showdata();
			},800);
		}
		
		function buildTablePhase(obj){
			var tbody = '';
			if(obj == 0){
				for(let i = 0;i<5;i++){
					if(i < 2){
						tbody += '<tr><td><span class = "span_tit" style="line-height:40px;font-size:40px;" id ="dat'+(i + 1)+'"></span>';
						tbody += '<span class = "span_data" style=" padding-top:28px;">'+ total_title[i] +'</span></td></tr>';
					}else{
						tbody += '<tr><td><span class = "span_tit" id ="lang_'+(i + 2)+'"></span>';
						tbody += '<span class = "span_data" id ="dat'+ (i + 1) +'></span>';
						tbody += '<span class = "span_unit">'+ total_title[i] +'</span></td></tr>';
					}
				}
			}else{
				tbody += '<tr><td><span class = "span_tit" >L'+ obj +'</span></td></tr>';
				tbody += '<tr><td><span class = "span_tit" style=" font-size:40px;" id="dat'+ (3*(obj-1) + 6)+'" ></span>';
				tbody += '<span class = "span_data" style=" padding-top:28px;">A</span></td></tr>';
				tbody += '<tr><td><div class = "progress"><div class="progress-bar" id="pgt'+ obj +'"></div></div></td></tr>';
				tbody += '<tr><td><span class = "span_tit" >L'+ obj +'-N:</span>';
				tbody += '<span class = "span_data"  id="dat'+ (3*(obj-1) + 7)+'" ></span>';
				tbody += '<span class = "span_unit">V</span></td></tr>';
				tbody += '<tr><td><span class = "span_tit" >PF:</span>';
				tbody += '<span class = "span_data"  id="dat'+ (3*(obj-1) + 8)+'" ></span>';
				tbody += '<span class = "span_unit"></span></td></tr>';
			}
			return tbody;
		}
		function buildTableLoop(obj){
			var tbody = '';
			tbody += '<tr><td colspan="10" style="text-align:left; padding-left:20px;  height:40px; border-bottom:#e1dfdf 2px solid;" id="lang_7"></td></tr>';
			tbody += '<tr><td class="spacing" id="lang_8"></td>';
			tbody += '<td class="spacing" id="lang_9"></td>';
			tbody += '<td class="spacing" id="lang_10"></td>';
			tbody += '<td class="spacing" id="lang_11"></td>';
			tbody += '<td class="spacing" id="lang_12"></td>';
			tbody += '<td class="spacing" id="lang_13"></td>';
			tbody += '<td class="spacing" id="lang_14"></td>';
			tbody += '<td class="spacing" id="lang_15"></td></tr>';
			for(var i = 0;i < obj;i++){
				if(i % 2 == 0){
					tbody += '<tr id = "tr'+ i +'" style="background:#e7e7e7;">';
				}else{
					tbody += '<tr id = "tr'+ i +'">';
				}
				for(var j = 0; j<8;j++){
					tbody += '<td class="spacing" id="dat'+ (16+ i * 8 + j)+'"></td>';
				}
			tbody += '</tr>';
			}
			return tbody;
		}
		function buildTableSensor(){
			var tbody ="";
			tbody += '<tr><td class="spacing" id="lang_17"></td>';
			tbody += '<td class="spacing" id="lang_18"></td>';
			tbody += '<td class="spacing" id="lang_19"></td>';
			tbody += '<td class="spacing" id="lang_20"></td></tr>';
			for(var i = 0;i < 4;i++){
				if(i % 2 == 0){
					tbody += '<tr style="background:#e7e7e7;">';
				}else{
					tbody += '<tr>';
				}
				for(var j = 0;j < 4;j++){
					if(j % 2 == 0){
						tbody += '<td class="spacing" id="lang_'+(21+i*2 + parseInt(j/2))+'"></td>';
					}else{
						tbody += '<td class="spacing" id="dat'+(63+i*2+parseInt(j/2))+'"></td>';
					}
				}
				tbody += '</tr>';
			}
			return tbody;
		}
		function buildTableSystem(){
			var tbody ="";
			for(var i = 0;i< 5;i++){
				if(i == 0){
					tbody +='<tr><td class="spacing" style="width:32%" id="lang_'+(30+i)+'"></td><td id="dat'+(71+i)+'" style="font-weight:bold"></td></tr>';
				}else{
					tbody +='<tr><td class="spacing" style="width:32%" id="lang_'+(30+i)+'"></td><td id="dat'+(71+i)+'"></td></tr>';
				}
			}
			return tbody;
		}
		function putdata(){
		}
		setInterval(function(){ 
			read_phase_data(addr);
			read_loop_data(addr);
			read_sensor_data(addr);
			read_total_data(addr);
		},2000);
    </script>
</body>
</html>
