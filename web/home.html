<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>home</title>
		<link rel="stylesheet" href="include/css/public.min.css">
		<link rel="stylesheet" href="include/css/index.min.css">
		<link rel="stylesheet" href="include/css/iconfont.min.css">
		<link rel="stylesheet" href="include/css/font-awesome.min.css">
		<link rel="stylesheet" href="doc-lib/solarized-light.css">
		<link rel="stylesheet" href="doc-lib/doc.css">

		<script src="include/js/jquery-1.11.3.min.js"></script>
		<script src="include/js/rpc-over-websocket.js"></script>
		<script src="include/js/public.min.js"></script>
		<script src="include/js/fn_public.js"></script>
		<script src="doc-lib/highlight.pack.js"></script>
		<script src="doc-lib/doc.js"></script>

		<style>
			.box{
				border: 1px solid #C4C2C3;
				background-color: #fff;
			}
			tr{
				height: 30px;
			}
		</style>
	</head>
<body>
	<div style="padding: 0px; margin-bottom: 0.8%; overflow: hidden; ">
		<div class="box" style="width: 100%; margin-bottom: 0.8%;  background:#e7e7e7;">
			<div class="panel panel-default">
				<div class="panel-heading"><i class="fa fa-sitemap fa-lg" style="padding-right: 5px;"></i><span id="lang_1"></span><ul style="float:right; font-family:courier;" ><span id="lang_2"></span><select id="ms" style="width:200px;" onChange="change();"></select></ul></div>
			</div>
			<div class ="phase_div1">
				<div class ="phase_div2" id="lang_3"></div>
				<div class ="phase_div">
					<table class ="phase_table total"></table>
				</div>
				<div class ="phase" id="L1">
					<table class ="phase_table p1"></table>
				</div>
				<div class ="phase " id="L2">
					<table class ="phase_table p2"></table>
				</table>
				</div>
				<div class ="phase" id="L3">
					<table class ="phase_table p3"></table>
				</div>
			</div>
			<div id="ht" class = "loop_div">	
				<table class = "loop_table "></table>
			</div>
			<table style="width:100%;height:203px; ">
				<tr>
					<td style=" width: 64%;">
						<div style=" width: 99%; margin-bottom: 0.8%; border:1px solid;border-color: #ffffff; margin-left:10px; height:203px; background:#ffffff; text-align:center;">
							<div style="text-align:left; padding-left:20px; padding-top:8px; height:40px; border-bottom:#e1dfdf 2px solid; font-size:12px;" id="lang_16"></div>
							<table class = "sensor_tab" style="height:32px; width:100%; font-size:12px;"></table>
						</div>
					</td>
					<td style="width: 32%;">
						<div style="width: 97%; margin-bottom: 0.8%; border:1px solid;border-color: #ffffff; margin-top:-5px; margin-left:10px; height:203px;  background:#ffffff; ">
						<div style="text-align:left; padding-left:20px; padding-top:8px; height:40px; border-bottom:#e1dfdf 2px solid; font-size:12px;" id="lang_29"></div>
						<table class = "sys_table" style=" font-size:12px;"></table>
						</div>
					</td>
				</tr>
			</table>
			<div style="border:0px solid;border-color: #aaaaff; margin:0px 10px 10px 10px; height:400px; background:#ffffff;">
				<div style="text-align:left; padding-left:20px; padding-top:8px; height:40px; border-bottom:#e1dfdf 2px solid;" id="lang_35"></div>
					<br>
					<div align="left" id="container" style="width:100%; height:360px;"></div>
				</div>
			</div>
		</div>
	</div>
    <script>
		var phase_info = new Array();
		var phase_num = parseInt(sessionStorage.getItem("PhaseNum" + addr));
		var loop_num = parseInt(sessionStorage.getItem("LoopNum" + addr));
		var len  = data_name.length -1;
		var total_title = new Array("kW","kVA","kWh","Hz","mA");
		function read_data(){
			for(var i = 1 ;i < phase_num + 1;i++){
				phase_info[i] =  new Array();
				for(var k = 0; k < 3; k++){
					for(var j = 0;j <len;j++){
						phase_info[i][(len * k) + j] = parseInt(sessionStorage.getItem(type_name[phase]+data_type[(k+2)]+data_name[j + 1]+addr+'_'+i));
					}
				}
			}
			
		}
		$('.total').html(buildTablePhase(0));
		$('.p1').html(buildTablePhase(1));
		$('.p2').html(buildTablePhase(2));
		$('.p3').html(buildTablePhase(3));
		$('.loop_table').html(buildTableLoop(6));
		$('.sensor_tab').html(buildTableSensor());
		$('.sys_table').html(buildTableSystem());
		
		function showdata(){
			for(var i = 1 ;i < phase_num + 1;i++){
				var ss = document.getElementById('pow'+(i -1)).childNodes[2].firstChild;
				var cs = document.getElementById('pow'+(i -1)).childNodes[1];
				if(phase_info[i][23] == 1){
					ss.checked = true;
				}
				else{
					ss.checked = false;
				}
				if(phase_info[i][18] == 2 || phase_info[i][18] == 4){
					cs.bgColor = 'yellow';
				}else if(phase_info[i][18] == 1 || phase_info[i][18] == 8){
					cs.bgColor = 'red';
				}
				else{
					cs.bgColor = '';
				}
				if(i == phase_num){
					if(pow_mark ==1){
						document.getElementById('pow'+(i)).childNodes[2].firstChild.checked = true;
					}else{
						document.getElementById('pow'+(i)).childNodes[2].firstChild.checked = false;
					}
				}
			}
			for(var i = 1 ;i < phase_num + 1;i++){
				ss = document.getElementById('cur'+(i -1)).childNodes[2].firstChild;
				cs = document.getElementById('cur'+(i -1)).childNodes[1];
				if(phase_info[i][15] == 1){
					ss.checked = true;
				}
				else{
					ss.checked = false;
				}
				if(phase_info[i][10] == 2 || phase_info[i][10] == 4){
					cs.bgColor = 'yellow';
				}else if(phase_info[i][10] == 1 || phase_info[i][10] == 8){
					cs.bgColor = 'red';
				}
				else{
					cs.bgColor = '';
				}
				if(i == phase_num){
					if(cur_mark ==1){
						document.getElementById('cur'+(i)).childNodes[2].firstChild.checked = true;
					}else{
						document.getElementById('cur'+(i)).childNodes[2].firstChild.checked = false;
					}
				}
			}
			for(var i = 1 ;i < phase_num + 1;i++){
				ss = document.getElementById('vol'+(i -1)).childNodes[2].firstChild;
				cs = document.getElementById('vol'+(i -1)).childNodes[1];
				if(phase_info[i][7] == 1){
					ss.checked = true;
				}
				else{
					ss.checked = false;
				}
				if(phase_info[i][2] == 2 || phase_info[i][2] == 4){
					cs.bgColor = 'yellow';
				}
				else if(phase_info[i][2] == 1 || phase_info[i][2] == 8){
					cs.bgColor = 'red';
				}
				else{
					cs.bgColor = '';
				}
				if(i == phase_num){
					if(vol_mark ==1){
						document.getElementById('vol'+(i)).childNodes[2].firstChild.checked = true;
					}else{
						document.getElementById('vol'+(i)).childNodes[2].firstChild.checked = false;
					}
				}
			}
		}
		function modeset(modesel){
			var ms = document.getElementById("sel");
			var iptname = document.getElementsByTagName("input");
			for(var i = 0; i<iptname.length;i++)
			{
				iptname[i].disabled = true;
			}
		}
		function readonlyset(ros){
			if(read === 0){
				read = 1;
				// var ms = document.getElementById("sel");
				// ms.style.display = "";
				ros.style.backgroundColor = 'red';
				ros.innerHTML = "设置模式";
				var iptname = document.getElementsByTagName("input");
				for(var i = 0; i<iptname.length;i++)
				{
					iptname[i].disabled = false;
				}
			}
			else{
				// var ms = document.getElementById("sel");
				// ms.style.display = "none";
				read = 0;
				ros.style.backgroundColor = '';
				ros.innerHTML = "阅读模式";
				var iptname = document.getElementsByTagName("input");
				for(var i = 0; i<iptname.length;i++)
				{
					iptname[i].disabled = true;
				}
			}
		}
		function flash_html(par)
		{
			read_phase_data(addr);
			setTimeout(function(){
				par.parentNode.parentNode.parentNode.remove();
				read_data();
				if(par.name == "pow"){
					$('.pow_table').html(buildTablePow(phase_num));
				}else if(par.name == "cur"){
					$('.cur_table').html(buildTableCur(phase_num));
				}else if(par.name == "vol"){
					$('.vol_table').html(buildTableVol(phase_num));
				}
				showdata();
			},800);
		}

		function buildTablePhase(obj){
			var tbody = '';
			if(obj == 0){
				for(let i = 0;i<5;i++){
					if(i < 2){
						tbody += '<tr><td><span class = "span_tit" style=" font-size:40px;" id ="dat'+(i + 1)+'"></span>';
						tbody += '<span class = "span_data" style=" padding-top:28px;">'+ total_title[i] +'</span></td></tr>';
					}else{
						tbody += '<tr><td><span class = "span_tit" id ="lang_'+(i + 1)+'"></span>';
						tbody += '<span class = "span_data" id ="dat'+ (i + 1) +'></span>';
						tbody += '<span class = "span_unit">'+ total_title[i] +'</span></td></tr>';
					}
				}
			}else{
				tbody += '<tr><td><span class = "span_tit" >L'+ obj +'</span></td></tr>';
				tbody += '<tr><td><span class = "span_tit" style=" font-size:40px;" id="dat'+ (3*(obj-1) + 6)+'" ></span>';
				tbody += '<span class = "span_data" style=" padding-top:28px;">A</span></td></tr>';
				tbody += '<tr><td><div class = "progress"><div class="progress-bar" id="pgt'+ obj +'"></div></div></td></tr>';
				tbody += '<tr><td><span class = "span_tit" >L'+ obj +'-N:</span>';
				tbody += '<span class = "span_data"  id="dat'+ (3*(obj-1) + 7)+'" ></span>';
				tbody += '<span class = "span_unit">V</span></td></tr>';
				tbody += '<tr><td><span class = "span_tit" >PF:</span>';
				tbody += '<span class = "span_data"  id="dat'+ (3*(obj-1) + 8)+'" ></span>';
				tbody += '<span class = "span_unit"></span></td></tr>';
			}
			return tbody;
		}
		function buildTableLoop(obj){
			var tbody = '';
			tbody += '<tr><td colspan="10" style="text-align:left; padding-left:20px;  height:40px; border-bottom:#e1dfdf 2px solid;" id="lang_7"></td></tr>';
			tbody += '<tr><td class="spacing" id="lang_8"></td>';
			tbody += '<td class="spacing" id="lang_9"></td>';
			tbody += '<td class="spacing" id="lang_10"></td>';
			tbody += '<td class="spacing" id="lang_11"></td>';
			tbody += '<td class="spacing" id="lang_12"></td>';
			tbody += '<td class="spacing" id="lang_13"></td>';
			tbody += '<td class="spacing" id="lang_14"></td>';
			tbody += '<td class="spacing" id="lang_15"></td></tr>';
			for(var i = 0;i < obj;i++){
				if(i % 2 == 0){
					tbody += '<tr id = "tr'+ i +'" style="background:#e7e7e7;">';
				}else{
					tbody += '<tr id = "tr'+ i +'">';
				}
				for(var j = 0; j<8;j++){
					tbody += '<td class="spacing" id="dat'+ (16+ i * 8 + j)+'"></td>';
				}
			tbody += '</tr>';
			}
			return tbody;
		}
		function buildTableSensor(){
			var tbody ="";
			tbody += '<tr><td class="spacing" id="lang_17"></td>';
			tbody += '<td class="spacing" id="lang_18"></td>';
			tbody += '<td class="spacing" id="lang_19"></td>';
			tbody += '<td class="spacing" id="lang_20"></td></tr>';
			for(var i = 0;i < 4;i++){
				if(i % 2 == 0){
					tbody += '<tr style="background:#e7e7e7;">';
				}else{
					tbody += '<tr>';
				}
				for(var j = 0;j < 4;j++){
					if(j % 2 == 0){
						tbody += '<td class="spacing" id="lang_'+(21+i*2 + parseInt(j/2))+'"></td>';
					}else{
						tbody += '<td class="spacing" id="dat'+(63+i*2+parseInt(j/2))+'"></td>';
					}
				}
				tbody += '</tr>';
			}
			return tbody;
		}
		function buildTableSystem(){
			var tbody ="";
			for(var i = 0;i< 5;i++){
				if(i == 0){
					tbody +='<tr><td class="spacing" style="width:40%" id="lang_'+(30+i)+'"></td><td id="dat'+(71+i)+'" style="font-weight:bold"></td></tr>';
				}else{
					tbody +='<tr><td class="spacing" style="width:40%" id="lang_'+(30+i)+'"></td><td id="dat'+(71+i)+'"></td></tr>';
				}
			}
			return tbody;
		}
		var state_ = 0,state1_ = 0,state2_ = 0;
		function putdata(){
			// for(let i = 0;i < phase_num;i++){
			// 	state_ = document.getElementById('vol'+(i)).childNodes[1];
			// 	state1_ = document.getElementById('cur'+(i)).childNodes[1];
			// 	state2_ = document.getElementById('pow'+i).childNodes[1];
			// 	state_.innerHTML = (parseFloat(phase_info[i + 1][0])/10).toFixed(1);
			// 	state1_.innerHTML = (parseFloat(phase_info[i + 1][8])/10).toFixed(2);
			// 	state2_.innerHTML = (parseFloat(phase_info[i + 1][16])/10);
			// }
		}
		setInterval(function(){
			// read_phase_data(addr);
			// setTimeout(function(){
			// 	read_data();
			// 	putdata();
			// 	showdata();
			// },800);
		},2000);
    </script>
</body>
</html>
