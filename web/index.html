<!DOCTYPE html>
<html lang="en">
  <body>
    <h1>JSON-RPC over Websocket demo</h1>
    <input id="url" type="text" placeholder="Type URL" value="ws://localhost:8000/websocket" style="width:20em;" /> 
    <button id="connect">connect</button>
    <div style="height: 0.3em;">&nbsp;</div>
    <button id="btn1">Calculate 1 + 2</button>
    <button id="btn2">Calculate 2 * 3</button>
    <div style="margin-top: 1em;">Event log:</div>
    <div id="log" style="background: #eee; height: 10em; padding: 0.5em; overflow:auto;"></div>
<div>
    <input id="cur" type="text" value="" style="width:20em;" /> 
    <input id="opSize" type="text" value="" style="width:20em;" /> 
    <input id="opName" type="text" value="" style="width:20em;" /> 
</div>
  </body>
  <script src="rpc-over-websocket.js"></script>
  <script>
    var rpc, E = function(id) { return document.getElementById(id); };
    var url = E('url'), connect = E('connect'), btn1 = E('btn1'), btn2 = E('btn2'), msglog = E('log') , cur = E('cur'), opSize = E('opSize'), opName = E('opName');
    var enable = function(en) { btn1.disabled = btn2.disabled = !en; url.disabled = en; connect.innerHTML = en ? 'disconnect' : 'connect'; };
    var log1 = text => msglog.innerHTML += text + '<br/>\n';
    var log2 = text2 => cur.value= text2.result;
    var log3 = text3 => opSize.value= text3.result;
    var log4 = text4 => opName.value= text4.result;
    enable(false);
    connect.onclick = function() {
      console.log(rpc);
      if (rpc) { rpc.close(); rpc = null; return; }
      rpc = jsonrpc(url.value,
            () => enable(true),
            () => enable(false),
            msg => log1('NOTIFICATION: ' + JSON.stringify(msg)));
      var g_interval;
      g_interval = window.setInterval(function(){
      if(enable && rpc){
          var res1,res2,res3;
    	  rpc.call('get' ,[1]).then(res1 => log2(res1));
          rpc.call('output_size_value' ,[1]).then(res2 => log3(res2));
          rpc.call('output_name_value' ,[1]).then(res3 => log4(res3));
      }
    },1000);

    };

    
    //window.clearInterval(g_interval);

    btn1.onclick = ev => rpc.call('sum', [33, 2]).then(res => log1('SUM:' + JSON.stringify(res)));
    btn2.onclick = ev => rpc.call('mul', [2, 3]).then(res => log1('MUL:' + JSON.stringify(res)));
  </script>
</html>
