<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIGN IN</title>
  <link rel="stylesheet" href="./include/css/style.css">
</head>
<body>
  <div class="outer_box">
    <div class="inner_box">
      <div class="center_form">
      </div>
    </div>
  </div>
  <script src="./include/js/jquery-1.11.3.min.js"></script>
	<script src="./include/js/rpc-over-websocket.js"></script>
	<script src="include/js/fn_public.js"></script>
  <script>
    read_user_data();
    function read_user_data(){
      user_name = sessionStorage.getItem(user_info[0]);
      password = sessionStorage.getItem(user_info[1]);
      identify = sessionStorage.getItem(user_info[2]);
      if(user_name !== '' && password !==''){
          $('.center_form').html(builddiv('signin'));
        }else{
          $('.center_form').html(builddiv('register'));
        }
    }

    function sign_in(){
      var div= document.getElementsByClassName('center_form');
      for(var i = 0; i<div[0].childElementCount;i++){
        div[0].removeChild(div[0].childNodes[i]);
      }
      $('.center_form').html(builddiv('signin'));
      window.open('index.html','_self');
    }
    function submite(){
      var div= document.getElementsByClassName('center_form');
      for(var i = 0; i<div[0].childElementCount;i++){
        div[0].removeChild(div[0].childNodes[i]);
      }
      $('.center_form').html(builddiv('submite'));
    }
    function register(){
      var div= document.getElementsByClassName('center_form');
      for(var i = 0; i<div[0].childElementCount;i++){
        div[0].removeChild(div[0].childNodes[i]);
      }
      $('.center_form').html(builddiv('register'));
    }
    function submite1(){
      var div= document.getElementsByClassName('center_form');
      for(var i = 0; i<div[0].childElementCount;i++){
        div[0].removeChild(div[0].childNodes[i]);
      }
      $('.center_form').html(builddiv('signin'));
    }
    function register1(){
      var div= document.getElementsByClassName('center_form');
      for(var i = 0; i<div[0].childElementCount;i++){
        div[0].removeChild(div[0].childNodes[i]);
      }
      $('.center_form').html(builddiv('signin'));
    }
    function printError(elemId, hintMsg)
    {
      document.getElementById(elemId).innerHTML = hintMsg;
    }
    function validataForm(ipt)
    {
      var con = document.getElementById("conpsd");
      var code = document.getElementById("ident");
      if(code != null)
      {
        if(ipt.value == "" && ipt.id == "username"){
          printError("Errinfo", "用户名不能为空");
        }else if(ipt.value == "" && ipt.id == "ident"){
          printError("Errinfo", "身份验证信息不能为空");
        }else{
          printError("Errinfo", "");
        }
      }
      if(con == null)
      {
        if(ipt.value == "" && ipt.id == "username"){
          printError("Errinfo", "用户名不能为空");
        }else if(ipt.value == "" && ipt.id == "psd"){
          printError("Errinfo", "密码不能为空");
        }
        else{
          printError("Errinfo", "");
        }
      }
      else{
        var psd_val = document.getElementById("psd");
        if(ipt.value == "" && ipt.id == "username"){
          printError("Errinfo", "用户名不能为空");
        }else if(ipt.value == "" && ipt.id == "psd"){
          printError("Errinfo", "请输入正确的密码");
        }
        else if((ipt.value == "" || ipt.value !== psd_val.value)&& ipt.id == "conpsd"){
          printError("Errinfo", "两次密码不一致，请重新输入");
        }
        else{
          printError("Errinfo", "");
        }
      }
      
    }
    function builddiv(Reg){
      var tbody = '';
      if(Reg === 'register')
      {
        tbody += '<p class="title"><span>R&nbsp;e&nbsp;g&nbsp;i&nbsp;s&nbsp;t&nbsp;e&nbsp;r&nbsp;</span><br/><span class="error" id = "Errinfo"></span></p>';
        tbody += '<p><input id ="username" type="username" maxlength="20"; placeholder="User Name" onblur = "validataForm(this)">';
        tbody += '<p><input id ="psd" type="text" maxlength="20"; placeholder="Password"></p>';
        tbody += '<p><input id ="conpsd" type="password" maxlength="20"; placeholder="Confirm Password"></p>';
        tbody += '<p><input id ="conpsd" type="text" maxlength="20"; autocomplete="off" onblur = "validataForm(this)"  placeholder="Identify Info"></p>';
        tbody += '<p class = "signIn_btn"><input type = "button" value = "REGISTER" onclick="register1()"></input></p>';
      }else if(Reg==='signin') {
        tbody += '<p class="title"><span>S&nbsp;i&nbsp;g&nbsp;n&nbsp;I&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;F&nbsp;o&nbsp;r&nbsp;m</span><br/><span class="error" id = "Errinfo"></p>';
        tbody += '<br/><p><input id ="username" type="text" maxlength="20" placeholder="User Name" onblur = "validataForm(this)">';
        tbody += '<p><input id ="psd" type="text" maxlength="20" autocomplete="off" onblur = "validataForm(this)"  placeholder="Password"></p>';
        tbody += '<div class="chk"><span></span><span><a href ="javascript:submite();">identify</a></span></div><p></p>';
        tbody += '<p class = "signIn_btn"><input type = "button" value = "SIGN IN" onclick="sign_in()"></p></input>';
      }else if(Reg === 'submite'){
        tbody += '<p class="title"><span>R&nbsp;e&nbsp;t&nbsp;r&nbsp;i&nbsp;e&nbsp;v&nbsp;e&nbsp;</span><br/><span class="error" id = "Errinfo"></p>';
        tbody += '<br/><p><input id ="username" type="text" maxlength="20" onblur= "validataForm(this)" placeholder="User Name">';
        tbody += '<p><input id ="ident" type="text" maxlength="20" onblur = "validataForm(this)" autocomplete="off"  placeholder="Identifying code"></p>';
        tbody += '<p></p><p class = "signIn_btn"><input type = "button" value = "SUBMITE" onclick="submite1()"></input></p>';
      }
      return tbody;
    }

    var time1 = setTimeout(function(){
      console.log("start");
      read_num_info(0);
      read_uut_info(0);
      read_cfg_info(0);
      read_dev_name();
      setTimeout(function(){
        read_phase_data(0);
        read_output_name(0);
        read_loop_data(0);
        read_output_data(0);
        read_sensor_data(0);
      },500);
    },500);

  </script>

</body>
</html>
