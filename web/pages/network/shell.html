<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>network</title>
		<link rel="stylesheet" href="../../include/css/public.min.css">
		<link rel="stylesheet" href="../../include/css/iconfont.min.css">
		<link rel="stylesheet" href="../../include/css/font-awesome.min.css">
	</head>
<body>
	<div class="page-cont">
		<div class="section">
			<div class="section-cont">
				<div class="grid-row">
					<div class="grid-col grid-col-7">
						<div class = "panel panel-default">
							<div class ="panel-heading">
								<i class = "fa fa-th-list fa-lg " style="padding-right:5px;"></i>
								<span id="lang_1"></span>
							</div>
						</div>
					</div>
					<div>
							<textarea id="script_content" onchange = "SetData(this)"  style="height:290px;width:99%;font-size: 18px;padding-left: 15px;padding-top: 15px;border: 2px solid #000;"></textarea>
					</div>
					<div class="grid-col grid-col-7 " style ="height: 30px;">
					</div>
					<div>
						<br/>
						<span style="text-align: center;" >
							<!-- <input type ="button" style = "width:15%" id  = "start" onclick="setData(this)"> -->
							<span id="lang_2"></span>
							<select class ="devname" id ="ms" style = "width:6%;margin-left: 2px" onchange = "Change(this);"></select>
							<span style = "margin-left: 5%" id="lang_6"></span><input id="chk" type="checkbox" onchange ="setData(this)" style="width:auto;position:static;display: inline;">
							<input type ="button" style = "width:12%;margin-left: 10%" id  = "exec" onclick="setData(this)">
							<!-- <input type ="button" style = "width:12%;margin-left: 6%" id  = "save" onclick="setData(this)"> -->
							<input type ="button" style = "width:12%;margin-left: 10%" id  = "clear" onclick="setData(this)">

						</span>
					</div>
					<div class="grid-col grid-col-7 " style ="height: 50px;">
					</div>
					<div>
						<textarea id="result" readonly ="true" style="height:390px;width:99%;padding-left: 15px;border: 2px solid #000;"></textarea>
					</div>
				</div>
			</div>
			<div class="grid-col grid-col-7 " style ="height: 150px;">
			</div>
		</div>

    <script src="../../include/js/jquery-1.11.3.min.js"></script>
    <script src="../../include/js/pdu_rpc.js"></script>
    <script src="../../include/js/public.min.js"></script>
    <script>
		let pdu_log = new PduLog;
		let pdu_cfg = top.pdu_cfg_;
		let language;
		let addr = 0;
		let shell_type = 50;
		setTimeout(() => {
			for(let i = 0;i<10;i++){
				pdu_cfg.getCfg(shell_type,1,i,0);
			}
			for(let i = 2;i<5;i++){
				pdu_cfg.getCfg(shell_type,i,0,0);
			}			
		}, 800);

		let btn_name = new Array("exec","clear");

		let dev_name =new Array();
		let lang = new Array();
		let script_num = new Array();
		let script = new Array();
	
		function ParseData(){
			let DataString = pdu_cfg.meta_value();
			let pdu_data = JSON.parse(DataString);
			if(pdu_data == null){
				ParseData();
			}
			language = pdu_data.pdu_info.language;
		}
		ParseData();
		lang_init();
		lang_fun();
		$('.devname').html(BuildSel(10));
		read_data();
		showdata();
		function lang_init(){
			let i = 0;
			for(i = 1;i<6;i++){
				lang[i] = new Array();
			}
			lang[1] = ["Shell 脚本","","","",""];
			lang[2] = ["选择脚本:","","","",""];
			lang[3] = ["脚本","","","",""];
			lang[4] = ["脚本执行","","","",""];
			lang[5] = ["清空结果","","","",""];
			lang[6] = ["开机自启动：","","","",""];
			for(let i = 1;i < 11;i++){
				dev_name[i] =  lang[3][language] + i;
			}

		}
		function lang_fun(){
			for(let i = 0;i<btn_name.length;i++){
				document.getElementById(btn_name[i]).value = lang[4+i][language];
			}
			document.getElementById("lang_1" ).innerHTML  = lang[1][language];
			document.getElementById("lang_2" ).innerHTML  = lang[2][language];
			document.getElementById("lang_6" ).innerHTML  = lang[6][language];
			
		}
		function BuildSel(rows)
		{
			var tbody = '';
			for(var i = 0;i<rows;i++)
			{
				tbody += '<option id = "opt'+ i + '"value ="'+ i +'">'+dev_name[i+1]+'</option>';
			}
			return tbody;
		}
		function read_data(){
			for(let i = 0;i<10;i++){
				script_num[i] = pdu_cfg.cfgValue(shell_type,1,i,0);
			}
			for(let i = 0;i<3;i++){
				script[i] = pdu_cfg.cfgValue(shell_type,i+2,0,0);
			}	
		}

		function showdata(){
			var id = document.getElementById("ms" ).value;
			document.getElementById("script_content" ).value = script[0];
			document.getElementById("result" ).value = script[2];
			if(0 == script_num[id]){
				document.getElementById("chk").checked = false;
			}else{
				document.getElementById("chk").checked = true;
			}

			if(top.login_permit_ == 1){
				$("input").attr("disabled","disabled");
				$("select").attr("disabled","disabled");
			}else{
			}
		}
		function showdata_(){
			document.getElementById("result" ).value = script[2];
		}
		function Change(sel){
				//let id = parseInt(sel.value);
				setTimeout(function(){
					for(let i = 0;i<10;i++){
						pdu_cfg.getCfg(shell_type,1,i,0);
					}
					for(let i = 2;i<5;i++){
						pdu_cfg.getCfg(shell_type,i,0,0);
					}
				},100);
				setTimeout(function(){
					read_data();
					showdata();
				},400);

			}

		// function SetData(btn){
		// 	if(btn.id == "script_content"){
		// 		pdu_cfg.setCfg(shell_type,2,btn.value,0,addr);
		// 	}else if(btn.id == "clear")
		// 		pdu_cfg.setCfg(shell_type,4,'',0,addr);
		//   //btn.blur();
		//   //FlashHtml();
		// }
		function FlashHtml(){
			for(let i = 0;i<10;i++){
				pdu_cfg.getCfg(shell_type,1,i,0);
			}
			for(let i = 2;i<5;i++){
				pdu_cfg.getCfg(shell_type,i,0,0);
			}
			setTimeout(function(){
				read_data();
				showdata_();
			},300);
		}

		function setData(btn){
			// var id = parseInt(document.getElementById("ms" ).value);
			var id = document.getElementById("ms" ).value;
			if(btn.id == "save"){

			}else if(btn.id == "exec"){ 
				var cmd = document.getElementById("script_content" ).value;
				pdu_cfg.setCfg(shell_type,2,cmd,id,0);
				pdu_cfg.setCfg(shell_type,3,1,id,0);

				 FlashHtml();
			}else if(btn.id == "clear"){
				pdu_cfg.setCfg(shell_type,4,'',id,0);
				FlashHtml();
			}else if(btn.id == "chk"){
				var id = parseInt(document.getElementById("ms" ).value);
				if(btn.checked == true){
					pdu_cfg.setCfg(shell_type,1,1,id,0);
				}else{
					pdu_cfg.setCfg(shell_type,1,0,id,0);
				}
			
			}
			
			
		}
		setInterval(function(){
			// let id = document.getElementById("ms" ).value;
			for(let i = 0;i<10;i++){
				pdu_cfg.getCfg(shell_type,1,i,0);
			}
			for(let i = 2;i<5;i++){
				pdu_cfg.getCfg(shell_type,i,0,0);
			}
			// read_data();
			showdata_();
			// setTimeout(function(){
			// 	pdu_cfg.setCfg(shell_type,4,'',id,0);
			// },1900);

		},2000);

    </script>
</body>
</html>
